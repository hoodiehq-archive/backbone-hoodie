/*! backbone-hoodie 10-04-2014 */
!function(a,b){"use strict";if("object"==typeof exports){var c=require("backbone"),d=require("hoodie");module.exports=b(c,d)}else"function"==typeof define&&define.amd?define(["backbone","hoodie"],b):a.Backbone.hoodie=b(a.Backbone,a.Hoodie)}(this,function(a,b){"use strict";return a.connect=function(c){a.hoodie=new b(c)},a.sync=function(b,c,d){var e,f,g,h;switch(f=c.id,e=d.attrs||c.toJSON(),h=c.type,h||(h=c.model.prototype.type),d.backbone=!0,b){case"read":g=f?a.hoodie.store.find(h,f):d.filter?a.hoodie.store.findAll(d.filter):a.hoodie.store.findAll(h);break;case"create":g=a.hoodie.store.add(h,e,d).done(function(a){c.set(a)});break;case"update":g=a.hoodie.store.updateOrAdd(h,f,c.changed,d).done(function(a){c.set(a)});break;case"delete":g=a.hoodie.store.remove(h,f,d)}return d.success&&g.done(d.success),d.error?g.fail(d.error):g},a.Model.prototype.merge=function(a){this.set(a,{remote:!0})},a.Collection.prototype.initialize=function(){var b,c,d=this;this.model&&(b=this.model.type,b&&(c=a.hoodie.store(b),c.on("add",function(a,b){var c;(!d.storeBindingFilter||d.storeBindingFilter(a))&&(c=d.add(a,b),d.trigger("create",c,b))}),c.on("remove",function(a,b){var c;(!d.storeBindingFilter||d.storeBindingFilter(a))&&(c=d.get(a.id),c&&c.destroy(b))}),c.on("update",function(a,b){var c;(!d.storeBindingFilter||d.storeBindingFilter(a))&&(c=d.get(a.id),b.remote&&c&&c.merge(a),d.trigger("update",c,b))})))},a});